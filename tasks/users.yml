---
- name: USERS | Create users
  user:
    name: "{{ item }}"
    comment: "{{ item }} account"
    generate_ssh_key: yes
    ssh_key_bits: 4096
    ssh_key_comment: "{{ item }}@{{ inventory_hostname }} - Generated by Ansible"
  with_items: "{{ webserver_environments }}"

- name: USERS | Create www directory for users
  file:
    path: "/home/{{ item }}/www/"
    state: directory
    owner: "{{ item }}"
    group: "{{ item }}"
    mode: 0775
  with_items: "{{ webserver_environments }}"

- name: USERS | Create log directories for users
  file:
    path: "/home/{{ item.0 }}/log/{{ item.1 }}"
    state: directory
    owner: "{{ item.0 }}"
    group: "{{ item.0 }}"
    mode: 0775
  with_nested:
    - "{{ webserver_environments }}"
    - [ 'nginx', 'php-fpm' ]